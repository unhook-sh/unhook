# Unhook VSCode Extension Analytics

This document describes the analytics integration for the Unhook VSCode extension.

## Overview

The Unhook VSCode extension includes optional analytics powered by PostHog to help improve the extension and understand how developers use webhooks. Analytics are **disabled by default** and respect VS Code's telemetry settings.

## Privacy First

- **Opt-in only**: Analytics are disabled by default
- **No PII**: We only track anonymous usage data and session IDs
- **User control**: Users can enable/disable analytics at any time
- **Transparent**: All tracked events are documented below
- **First-time consent**: New users are prompted for analytics consent during onboarding
- **VS Code telemetry integration**: Respects VS Code's global telemetry settings

## VS Code Telemetry Integration

The extension respects VS Code's global telemetry settings:

- If `"telemetry.telemetryLevel": "off"` is set in VS Code settings, analytics will be automatically disabled
- If `"telemetry.telemetryLevel": "on"` is set, users can still choose to disable Unhook analytics specifically
- Changes to VS Code telemetry settings are automatically detected and applied

## Common Properties

Every analytics event includes the following common properties for better analysis:

### Extension Properties
- `common.extname` - The extension name (`unhook-vscode`)
- `common.extversion` - The extension version

### VS Code Properties
- `common.vscodemachineid` - A common machine identifier generated by VS Code
- `common.vscodesessionid` - A session identifier generated by VS Code
- `common.vscodeversion` - The version of VS Code running the extension

### OS and Platform Properties
- `common.os` - The OS running VS Code (e.g., `darwin`, `win32`, `linux`)
- `common.platformversion` - The Node.js version
- `common.product` - What VS Code is hosted in (e.g., `Visual Studio Code`, `Cursor`, `GitHub Codespaces`)
- `common.uikind` - Web or Desktop indicating where VS Code is running
- `common.remotename` - A name to identify the type of remote connection (`local`, `ssh`, `docker`, `wsl`, etc.)
- `common.nodeArch` - What architecture of Node.js is running (e.g., `arm64`, `x64`)

## Configuration

### First-Time Setup
When you first install the extension and sign in, you'll be prompted to enable analytics with a clear explanation of what data is collected (unless VS Code telemetry is globally disabled).

### Manual Configuration
To enable analytics manually, simply toggle the setting in VSCode:

```json
{
  "unhook.analytics.enabled": true
}
```

Or use the VSCode Settings UI:
1. Open VSCode Settings (Cmd/Ctrl + ,)
2. Search for "unhook analytics"
3. Check the "Enable anonymous usage analytics" box

### Command Palette
You can also use the command palette to change your analytics preference:
1. Open Command Palette (Cmd/Ctrl + Shift + P)
2. Type "Unhook: Analytics Consent"
3. Choose your preference

## Tracked Events

### Extension Lifecycle
- `extension_activated` - When the extension is activated
  - Properties: `activation_time_ms`, `workspace_folders`, `has_config_file`
- `extension_deactivated` - When the extension is deactivated

### Authentication
- `user_signed_in` - When a user signs in
  - Properties: `method`
- `user_signed_out` - ~~When a user signs out~~ **DEPRECATED**: Use `auth_sign_out_success` or `quick_pick_sign_out` instead

### Commands
All commands are automatically tracked with:
- `command_executed` - When any command is run
  - Properties: `command`, `timestamp`
- `command_completed` - When a command completes successfully
  - Properties: `command`, `duration_ms`, `success`
- `command_failed` - When a command fails
  - Properties: `command`, `duration_ms`, `error`

### Webhook Events
- `webhook_received` - When a new webhook event is received
  - Properties: `provider`, `event_id`, `status`, `has_requests`, `request_count`
- `webhook_status_changed` - When a webhook event status changes
  - Properties: `provider`, `event_id`, `old_status`, `new_status`
- `webhook_delivered` - When a webhook is successfully delivered
  - Properties: `provider`, `event_id`, `destination_count`, `auto_delivery`
- `webhook_delivery_failed` - When webhook delivery fails
  - Properties: `provider`, `event_id`, `error`, `retry_count`, `max_retries`

### Configuration Changes
- `workspace_config_changed` - When workspace configuration changes
  - Properties: `sections` (array of changed config sections)
- `config_changed` - When a specific setting is changed
  - Properties: `setting`, `value`

### UI Events
- `terminal_opened` - When a terminal is opened
- `editor_changed` - When the active editor changes
  - Properties: `language`, `is_untitled`

## User Identification

- **Authenticated users**: Identified by their Unhook user ID and email
- **Unauthenticated users**: Identified by a persistent anonymous session ID

## Data Retention

Analytics data follows PostHog's standard retention policies. No webhook payload data is ever sent to analytics.

## Disabling Analytics

### Method 1: VS Code Global Telemetry
Set VS Code's global telemetry to off:
```json
{
  "telemetry.telemetryLevel": "off"
}
```

### Method 2: Unhook Analytics Setting
Disable Unhook analytics specifically:
```json
{
  "unhook.analytics.enabled": false
}
```

Or uncheck the box in the VSCode Settings UI.

## Development

### Adding New Events

When adding new analytics events:

1. Use the `AnalyticsService` instance available through the extension
2. Follow the naming convention: `noun_verb` (e.g., `webhook_received`)
3. Include relevant context but never include sensitive data
4. Document the event in this README

Example:
```typescript
analyticsService.track('feature_used', {
  feature_name: 'split_view',
  viewport_width: 180
});
```

### Testing Analytics

In development mode, analytics events are logged to the console but not sent to PostHog unless the extension is running in production mode.

## Questions or Concerns

If you have any questions or concerns about analytics, please open an issue on our GitHub repository.